<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>CS2 Web - Tracers & Physics</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Arial Black', sans-serif; }
        
        /* MIRA EM FORMATO DE PONTO */
        #crosshair { 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            width: 4px;           /* Largura do ponto */
            height: 4px;          /* Altura do ponto */
            background: #00ff00;  /* Cor verde neon */
            border-radius: 50%;   /* Deixa o ponto redondo */
            box-shadow: 0 0 2px #000; /* Borda preta fina para não sumir em lugares claros */
            transform: translate(-50%, -50%); 
            pointer-events: none; 
            z-index: 10;
        }
    
        #ui { 
            position: absolute; bottom: 30px; left: 30px; color: #00ff00; 
            font-size: 28px; z-index: 10; text-shadow: 2px 2px #000; 
        }
        #instructions {
            position: absolute; width: 100%; height: 100%; display: flex; flex-direction: column;
            align-items: center; justify-content: center; color: white; 
            background: rgba(0,0,0,0.9); z-index: 100; cursor: pointer;
        }
        .hit-marker { position: absolute; top: 50%; left: 50%; color: white; font-size: 30px; 
                      transform: translate(-50%, -50%); display: none; pointer-events: none; }
    </style>
</head>
<body>

    <div id="crosshair"></div>
    <div id="hit" class="hit-marker">+</div>
    <div id="ui">KILLS: <span id="score">0</span></div>
    
    <div id="instructions" onclick="iniciar()">
        <h1>INICIAR PARTIDA</h1>
        <p>Tiros visíveis e física de impacto ativados</p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        let scene, camera, renderer, gun;
        let score = 0, targets = [], bullets = [], keys = {};

        function iniciar() {
            document.getElementById('instructions').style.display = 'none';
            
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a0a0a);
            scene.fog = new THREE.Fog(0x0a0a0a, 0, 70);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.rotation.order = 'YXZ';

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Luzes
            const light = new THREE.HemisphereLight(0xffffff, 0x444444, 1);
            scene.add(light);

            // Chão
            const floor = new THREE.Mesh(new THREE.PlaneGeometry(200, 200), new THREE.MeshPhongMaterial({color: 0x151515}));
            floor.rotation.x = -Math.PI/2;
            scene.add(floor);
            scene.add(new THREE.GridHelper(200, 50, 0x333333, 0x222222));

            // Arma
            gun = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.12, 0.5), new THREE.MeshPhongMaterial({color: 0x222222}));
            gun.position.set(0.35, -0.3, -0.6);
            camera.add(gun);
            scene.add(camera);

            // Inimigos com "Física" (velocidade própria)
            for(let i=0; i<15; i++) {
                const target = new THREE.Mesh(
                    new THREE.BoxGeometry(1.5, 3, 1.5), 
                    new THREE.MeshPhongMaterial({color: 0xaa0000})
                );
                target.position.set(Math.random()*60-30, 1.5, Math.random()*60-30);
                target.userData = { velocity: new THREE.Vector3() }; // Dados de física
                scene.add(target);
                targets.push(target);
            }

            window.onkeydown = (e) => keys[e.code] = true;
            window.onkeyup = (e) => keys[e.code] = false;
            window.onmousedown = atirar;

            document.addEventListener('mousemove', (e) => {
                if (document.pointerLockElement === document.body) {
                    camera.rotation.y -= e.movementX * 0.002;
                    camera.rotation.x -= e.movementY * 0.002;
                    camera.rotation.x = Math.max(-1.5, Math.min(1.5, camera.rotation.x));
                }
            });

            document.body.requestPointerLock();
            animate();
        }

        function atirar() {
            if (document.pointerLockElement !== document.body) return;

            // 1. ANIMAÇÃO DE RECUO DA ARMA
            gun.position.z += 0.15;

            // 2. CRIAR PROJÉTIL VISÍVEL (TRACER)
            const tracerGeo = new THREE.SphereGeometry(0.04);
            const tracerMat = new THREE.MeshBasicMaterial({color: 0xffff00});
            const tracer = new THREE.Mesh(tracerGeo, tracerMat);
            
            // Posiciona na arma
            tracer.position.copy(camera.position);
            const bulletDir = new THREE.Vector3();
            camera.getWorldDirection(bulletDir);
            
            tracer.userData = { 
                direction: bulletDir.clone(),
                speed: 1.5, // Velocidade do rastro
                life: 0 
            };
            scene.add(tracer);
            bullets.push(tracer);

            // 3. DETECÇÃO DE KILL (RAYCAST)
            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera(new THREE.Vector2(0, 0), camera);
            const intersects = raycaster.intersectObjects(targets);

            if (intersects.length > 0) {
                const hit = intersects[0].object;
                
                // Física de Impacto: Empurra o inimigo para trás
                const impactDir = bulletDir.clone().multiplyScalar(0.5);
                hit.userData.velocity.add(impactDir);

                // Lógica de Kill
                score++;
                document.getElementById('score').innerText = score;

                // Hitmarker
                const hm = document.getElementById('hit');
                hm.style.display = 'block';
                setTimeout(() => hm.style.display = 'none', 100);

                // Mudar cor e Reset
                hit.material.color.set(0xffffff);
                setTimeout(() => {
                    hit.material.color.set(0xaa0000);
                    hit.position.set(Math.random()*60-30, 1.5, Math.random()*60-30);
                    hit.userData.velocity.set(0,0,0);
                }, 150);
            }
        }

        function animate() {
            requestAnimationFrame(animate);

            // MOVIMENTAÇÃO DO JOGADOR
            if (document.pointerLockElement === document.body) {
                const speed = 0.15;
                const moveDir = new THREE.Vector3();
                camera.getWorldDirection(moveDir);
                moveDir.y = 0; moveDir.normalize();
                const sideDir = new THREE.Vector3().crossVectors(camera.up, moveDir).normalize();

                if(keys['KeyW']) camera.position.addScaledVector(moveDir, speed);
                if(keys['KeyS']) camera.position.addScaledVector(moveDir, -speed);
                if(keys['KeyA']) camera.position.addScaledVector(sideDir, speed);
                if(keys['KeyD']) camera.position.addScaledVector(sideDir, -speed);
            }

            // ATUALIZAR FÍSICA DOS INIMIGOS (Recuo ao levar tiro)
            targets.forEach(t => {
                t.position.add(t.userData.velocity);
                t.userData.velocity.multiplyScalar(0.9); // Atrito para parar o movimento
            });

            // ATUALIZAR PROJÉTEIS (Tiros saindo da arma)
            bullets.forEach((b, index) => {
                b.position.add(b.userData.direction.clone().multiplyScalar(b.userData.speed));
                b.userData.life++;
                if(b.userData.life > 50) { // Remove após certa distância
                    scene.remove(b);
                    bullets.splice(index, 1);
                }
            });

            // Suavização da arma e altura
            gun.position.z += (-0.6 - gun.position.z) * 0.1;
            camera.position.y = 1.6;

            renderer.render(scene, camera);
        }
    </script>
</body>
</html>